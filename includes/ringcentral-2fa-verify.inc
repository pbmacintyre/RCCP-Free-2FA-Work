<?php/** * Copyright (C) 2019-2022 Paladin Business Solutions * */// Get the mobile number associated with the admin user// 	    $to = get_user_meta( $user->ID, 'RingCentral_2fa_user_mobile_number', true );$to = "9029405827";$phone_partial = substr($to, -4);$random_code = rand(100000, 999999);// put code in the session$_SESSION['random_code'] = $random_code;// add space in the code for readability before sending to SMS (optional)// $random_code = substr($random_code, 0, 3) . " " . substr($random_code, 3, 3);// connect to SDK with credentials in the DB$sdk = ringcentral_sdk();$from = ringcentral_get_from_phone();try {    // echo "in try...";    $apiResponse = $sdk->platform()->post('/account/~/extension/~/sms',        array('from' => array('phoneNumber' => $from),            'to' => array(array('phoneNumber' => $to)),            'text' => $_SESSION['random_code']));}catch (\RingCentral\SDK\Http\ApiException $e) {    // Getting error messages using PHP native interface    $apiResponse = $e->apiResponse();    $message = '  Message: ' . $e->apiResponse->response()->error() . PHP_EOL;    // craft a friendly message here.    $return_message = "There was an error sending the validation code, Please try again later <br/>" . $message;}echo "</br>Session Object: <pre>";var_dump($_SESSION);echo "</pre>";?><style>    <!--    .RCValidate {        width: 40%;        margin-top: 3%;        margin-left: auto;        margin-right: auto;        /* border: 1px solid red ; */    }    .RCValidate td {        text-align: center;    }    --></style><?php// create a unique token code to ensure the same process is happening$generated_token = rand(1, 9999999);$_SESSION['RingCentral_session_token'] = $generated_token;$post_token = $generated_token;?><table class="RCValidate">    <tr>        <td>            <img id='page_title_img' title="RingCentral Plugin" src="<?= RINGCENTRAL_LOGO; ?>">            <h1 id='page_title'><?= "RingCentral 6 Digit Admin access Validation"; ?></h1>        </td>    </tr>    <form name="loginform" id="loginform"          action="<?php echo esc_url(site_url('wp-login.php', 'login_post')) ?>"          method="post" autocomplete="off">        <tr>            <td>                We have sent you a 6 digit validation code to the number we have on file ending in                <?php echo $phone_partial; ?>.                </br>                Please enter that code here to validate your access.</br> </br>            </td>        </tr>        <tr>            <td>                <label for="ringcentral_2fa_code">6 digit validation code:                    </br> </br>                    <input type="text" name="ringcentral_2fa_code" value="" size="6"/>                </label>            </td>        </tr>        <tr>            <td>                </br>                <input type="submit" name="submit" class="button button-primary button-large"                       value="Validate Code"/>            </td>        </tr>        <input type="hidden" name="log" value="<?php echo esc_attr($user->user_login) ?>">        <input type="hidden" name="ringcentral_post_token" value="<?php echo esc_attr($post_token) ?>"/>        <input type="hidden" name="redirect_to" value="<?php echo esc_attr($redirect_to) ?>">    </form></table>